<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="{{ url_for('static', filename='images/logo/opengsync_128.png') }}" sizes="any" type="image/png">

        <title>OpeNGSync</title>
        <!-- Custom CSS --> 
        <link href="{{ url_for('static', filename='style/compiled/style.css') }}" rel="stylesheet" type="text/css"> 
        
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

        <!-- Sweet Alert 2 -->
        <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bootstrap-4@4/bootstrap-4.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>

    <body>
        <h2 style="padding-left: 10px; margin: 0;">{{ msg }} ({{ code }})</h2>
        <script>
            function render_flash_messages() {
                $.ajax({
                    url: "{{ url_for('retrieve_flash_messages') }}",
                    type: "GET"
                }).done(function(data) {
                    let messages = Array.isArray(data) ? data : (data && data.messages ? data.messages : []);
                    if (!messages.length) {
                        return;
                    }
                    showOneFlashFromList(messages, 0);
                });
            }

            function showOneFlashFromList(messages, index) {
                if (index >= messages.length) {
                    return;
                }
                const msg = messages[index];
                Swal.fire({
                    position: 'top',
                    icon: msg.category || 'success',
                    html: `<div style="display: flex; justify-content: center; align-items: center; height: 100%; padding: 0; font-weight: 600;">${msg.message}</div>`,
                    showConfirmButton: false,
                    timer: msg.category === 'error' ? null : 1000,
                    toast: true,
                    showCloseButton: true,
                    willClose: function() {
                        showOneFlashFromList(messages, index + 1);
                    }
                });
            }
            document.addEventListener('DOMContentLoaded', function() {
                render_flash_messages();
            });
        </script>
    </body>
</html>