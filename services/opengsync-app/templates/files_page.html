{% from "components/table_col.jinja2" import browser_col %}

{% extends "base.html" %}
{% set active_page = "browser-page" %}
{% block content %}
<div class="file-browser" id="file-browser-container">
    <table>
        <thead>
            <tr>
                {{
                    browser_col(
                        "Name", "name", sort_url="browser_page.files",
                        url_context={"subpath": current_path.as_posix() if current_path else "", },
                        sort_by=sort_by, sort_order=sort_order, col_size=6
                    )
                }}
                {{
                    browser_col(
                        "Size", "size", sort_url="browser_page.files",
                        url_context={"subpath": current_path.as_posix() if current_path else "", },
                        sort_by=sort_by, sort_order=sort_order, col_size=2
                    )
                }}
                {{
                    browser_col(
                        "Last Modified", "mtime", sort_url="browser_page.files",
                        url_context={"subpath": current_path.as_posix() if current_path else "", },
                        sort_by=sort_by, sort_order=sort_order, col_size=2
                    )
                }}
                <th class="col-2">Associations</th>
            </tr>
        </thead>
        <tbody>
            {% if current_path.parts %}
            <tr>
                <td class="col-6"><a href="{{ url_for('browser_page.files', subpath=parent_dir if parent_dir else '', sort_by=sort_by, sort_order=sort_order) }}">../</a></td>
                <td class="col-2">-</td>
                <td class="col-2">-</td>
                <td class="col-2">-</td>
            </tr>
            {% endif %}
            <tr hx-get="{{ url_for('files_htmx.files', subpath=current_path, sort_by=sort_by, sort_order=sort_order) }}" hx-trigger="intersect once" hx-swap="outerHTML">
                <td colspan="4">{{ spinner() }}</td>
            </tr>
        </tbody>
    </table>
</div>
<script>
    let selected_path = null;

    function share_path() {
        htmx.ajax(
            "GET", "{{ url_for('files_htmx.share_path') }}?path=" + selected_path,
            {
                target: "#xl-modal-content",
                swap: "innerHTML"
            }
        ).then(() => {
            $("#xl-modal").modal("show");
        });
    }

    $(document).ready(function() {
        $(document).off("contextmenu", ".path-row").on("contextmenu", ".path-row", function(e) {
            e.preventDefault();
            const x = e.pageX;
            const y = e.pageY;
            selected_path = $(this).data("path");

            $("#context-menu-container").css({
                display: "block",
                left: x + 8, top: y + 8
            }).empty().append([
                `<li><a class='dropdown-item' onclick='share_path()'>Share</a></li>`
            ]);

            $("#right-click-bg").css({ display: "block" });
        });
    });
</script>
{% endblock content %}